# namespace for sex events in between first initiating the scene and cumming
# sub/dom progression for each event is specific to that event (e.g. handjob tease into random other event or just directly handjob cum)
namespace = LIDAs
LIDAs.1 = {
	# F handjob tease
	type = character_event
	title = LIDAs.1.t
	desc = {
		desc = LIDAs.1.desc

		first_valid = {
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 1
				}
				desc = prev_custom_desc_1
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 2
				}
				desc = prev_custom_desc_2
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 3
				}
				desc = prev_custom_desc_3
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 4
				}
				desc = prev_custom_desc_4
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 5
				}
				desc = prev_custom_desc_5
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 6
				}
				desc = prev_custom_desc_6
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 7
				}
				desc = prev_custom_desc_7
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 8
				}
				desc = prev_custom_desc_8
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 9
				}
				desc = prev_custom_desc_9
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 10
				}
				desc = prev_custom_desc_10
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 11
				}
				desc = prev_custom_desc_11
			}
			triggered_desc = {
				trigger = {
					exists = scope:prev_custom_desc
					scope:prev_custom_desc <= 12
				}
				desc = prev_custom_desc_12
			}
		}

		first_valid = {
			triggered_desc = {
				trigger = {
					scope:root_stamina < 2
				}
				desc = f_very_low_stam
			}
			triggered_desc = {
				trigger = {
					scope:root_stamina < 3
				}
				desc = f_low_stam
			}
			triggered_desc = {
				trigger = { 
					scope:root_stamina < 4
				}
				desc = f_med_stam
			}
			desc = f_high_stam
		}
		first_valid = {
			triggered_desc = {
				trigger = {
					scope:partner_stamina < 2
				}
				desc = m_very_low_stam
			}
			triggered_desc = {
				trigger = {
					scope:partner_stamina < 3
				}
				desc = m_low_stam
			}
			triggered_desc = {
				trigger = { 
					scope:partner_stamina < 4
				}
				desc = m_med_stam
			}
			desc = m_high_stam
		}
	}
	theme = seduction
	left_portrait = {
		character = root
		animation = flirtation
	}
	right_portrait = {
		character = scope:affairs_partner
		animation = flirtation_left
	}

	immediate = {
		calculate_dom_success_effect = yes
		# each event reduces stamina for both partner by a certain amount
		lida_ongoing_sex_effect = {
			STAMINA_COST_1 = 0
			STAMINA_COST_2 = 1
		}
		debug_log_scopes = yes
	}

	# dom and sub choice
	option = {
		# dom option
		name = LIDAs.1.a
		custom_tooltip = LIDAs.1.a.tt

		# if you choose dom option but are not successful, you get taken down a peg
		if = {
			limit = {
				exists = scope:dom_success
			}
			# asserted dominance
			hidden_effect = {
				reverse_add_opinion = {
					target = scope:affairs_partner
					modifier = dominant_opinion
					opinion = 1
				}
			}
			# TODO trigger next dom event
			save_scope_value_as = {
				name = prev_custom_desc
				value = {0 4}
			}
		}
		else = {
			# get taken down a peg so lose some dominance
			hidden_effect = {
				reverse_add_opinion = {
					target = scope:affairs_partner
					modifier = dominant_opinion
					opinion = -2
				}
				# TODO description of you getting dommed (and specify a random reason for why you failed the dom)
				save_scope_value_as = {
					name = prev_custom_desc
					value = {5 8}
				}
			}
			# TODO trigger next sub event
		}
		# TODO if stamina is very low then trigger cum event and end, otherwise choose another event
		if = {
			limit = {
				scope:partner_stamina <= 1
			}
			hidden_effect = {
				carn_had_sex_with_effect = {
					CHARACTER_1 = root
					CHARACTER_2 = scope:affairs_partner
					C1_PREGNANCY_CHANCE = 0
					C2_PREGNANCY_CHANCE = 0
					STRESS_EFFECTS = yes
					DRAMA = yes
				}
			}
		}
		else = {
			trigger_event = LIDAs.1
		}
	}
	option = {
		name = LIDAs.1.b
		custom_tooltip = LIDAs.1.b.tt
		# lose dominance by choosing the sub option, but not as much as getting reversed
		hidden_effect = {
			reverse_add_opinion = {
				target = scope:affairs_partner
				modifier = dominant_opinion
				opinion = -1
			}
		}
		save_scope_value_as = {
			name = prev_custom_desc
			value = {9 12}
		}
		# TODO trigger next sub event
		# TODO if stamina is very low then trigger cum event and end, otherwise choose another event
		if = {
			limit = {
				scope:partner_stamina <= 1
			}
			hidden_effect = {
				carn_had_sex_with_effect = {
					CHARACTER_1 = root
					CHARACTER_2 = scope:affairs_partner
					C1_PREGNANCY_CHANCE = 0
					C2_PREGNANCY_CHANCE = 0
					STRESS_EFFECTS = yes
					DRAMA = yes
				}
			}
		}
		else = {
			trigger_event = LIDAs.1
		}
	}
}
