# LazyIcarus dynamic affairs

# main namespace of all common events
namespace = LIDA
LIDA.50 = {
	# main event hub An Illicit Affair
	type = character_event
	title = LIDA.50.t
	desc = {
		desc = LIDA.50.desc
		# triggered description with triggered_desc
	}
	# probably can use a custom theme
	theme = seduction
	left_portrait = {
		character = root
		# can also have triggered animation depending on current mood (horny, past history with this character and so on)
		animation = flirtation
		# consider using triggered_outfit to force an outfit? or directly just have { outfit_tags = {...} }
	}
	right_portrait = {
		character = scope:affairs_partner
		animation = flirtation_left
	}
	trigger = {
		# TODO cooldown, shorter for lustful characters, longer for chaste
	}
	# select affairs partner
	immediate = {
		get_characters_eligible_partner_effect = {
			LISTNAME = affairs_pool
			RESTRICTED_LISTNAME = rejected_affairs_pool
		}
		random_in_list = {
			list = affairs_pool
			limit = {
				NOR = {
					has_trait = celibate
					has_sexuality = asexual
				}
				age >= 18
			}
			save_temporary_scope_as = affairs_candidate
			# TODO need to check if list is empty?
			weight = {
				base = 50
				# TODO if the root character is a deviant/sadist, then having negative opinion actually makes them more likely as a partner (hate fuck) 
				opinion_modifier = {
					opinion_target = root
					multiplier = 0.2
				}
				compatibility_modifier = {
					compatibility_target = root
					multiplier = 0.1
				}
				# add based on attraction
				modifier = {
					add = {
						value = attraction
						divide = high_positive_attraction
						multiply = 50
					}
				}
				# if you've previously had relations with this person then weight them highly
				# either one of you should be the dom of the other
				modifier = {
					add = 1000
					has_opinion_modifier = {
						target = root
						modifier = dominant_opinion
					}
				}
			}
			save_scope_as = affairs_partner
		}
		# TODO remove after
		debug_log = "affairs all in list"
		every_in_list = {
			list = affairs_pool
			debug_log_scopes = no
			if = {
				limit = {
					has_opinion_modifier = {
						target = root
						modifier = dominant_opinion
						value >= 2
					}
				}
				debug_log = "you dom them >= 2"
			}
			if = {
				limit = {
					has_opinion_modifier = {
						target = root
						modifier = dominant_opinion
						value <= -2
					}
				}
				debug_log = "they dom you >= 2"
			}
		}
	}
	option = {
		# engage with the selected character
		name = LIDA.50.a
		custom_tooltip = LIDA.50.a.tt
		# inititalize staminas
		# triggered descriptions based on current stamina
		save_scope_value_as = {
			name = root_stamina
			value = max_sex_stamina
		}
		save_scope_value_as = {
			name = partner_stamina
			value = scope:affairs_partner.max_sex_stamina 
		}
		# go straight to the sex event if we already have an ongoing affair with this person
		if = {
			limit = {
				reverse_has_opinion_modifier = {
					target = scope:affairs_partner
					modifier = dominant_opinion
				}
			}
			select_start_affairs_effect = yes
		}
		# otherwise go through special first time event
		else = {
			select_first_meet_affairs_effect = yes
		}
	}
	option = {
		# reroll
		# add this sampled character to an exclusion list
		name = LIDA.50.b
		custom_tooltip = LIDA.50.b.tt
		scope:affairs_partner = {
			add_to_list = rejected_affairs_pool
		}
		trigger_event = LIDA.50
	}
	option = {
		# do nothing / close the event
		name = LIDA.50.c
		custom_tooltip = LIDA.50.c.tt
	}
}
